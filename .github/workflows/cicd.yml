name: CI/CD Workflow

on:
  push:
    branches:
      - develop

jobs:
  branch-develop-job:
    if: github.ref == 'refs/heads/develop'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Build Docker image for development
        run: docker build -f Dockerfile.dev -t app-dev .

      - name: Build application using make
        run: |
          docker run --rm \
          -v ${{ github.workspace }}:/app -w /app app-dev \
          /bin/bash -c "cd /app/src && make debug && /app/src/build/cm -h 0.0.0.0 -p 2310 -P 2443 -l /var/logs/cm.log & sleep 5 && chmod +x /app/test.sh && /app/test.sh"
